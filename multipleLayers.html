<html>
<head>
<title>Multiple Layers</title>
	<!-- the following links add the CSS and Javascript required for the Leaflet Map -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw==" crossorigin=""/>

	<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js" integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA==" crossorigin=""></script>

	<!-- the following CSS is used to set the size of the Map -->
	<style type="text/css">
	#mapid { height: 180px; }
	</style>

	<!-- the following script will allow the buttons to load and remove the earthquake and bus stop data -->
	<script>
		function loadEarthquakeData(){
			alert("Loading Earthquake data");
			getData("earthquakes");
		}

		function loadBusstopData(){
			alert("Loading Bus stop data");
			getData("busstops");
		}

		// create a global variable that will hold the XMLHttpRequest()
		var client;

		// create a global variable that will hold the layer itself
		var earthquakelayer;

		// create a global variable that will hold the layer itself
		var busstoplayer;

		// create the code to get the Earthquake and Bus stop data using XMLHttpRequest
		function getData(layername){
			client = new XMLHttpRequest();

			// outcome depends on the layername used
			var url;
			if (layername == "earthquakes"){
				url = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson'
			}
			if (layername == "busstops"){
				url = 'https://developer.cege.ucl.ac.uk:31050/cege0043-week2/busstops.geojson'
			}

			client.open('GET',url);
			client.onreadystatechange = dataResponse;
			client.send();
		}

		// create the code to wait for the response from the data server (listener, state 4) and process the response once it is received
		function dataResponse(){
			if (client.readyState == 4){
				var geoJSONdata=client.responseText;
				loadlayer(geoJSONdata);
			}
		}

		// convert received data from text to JSON format
		function loadlayer(geoJSONdata){
			// outcome depends on layername used
			if (geoJSONdata.indexOf("earthquake")>0){
				var loadingEarthquakes = true;
			}
			if (geoJSONdata.indexOf("IIT_METHOD")>0){
				var loadingBusstops = true;
			}

			var json = JSON.parse(geoJSONdata);

			// add the layer to the map using default icons
			if (loadingEarthquakes === true){
				earthquakelayer = L.geoJson(json).addTo(mymap);
				mymap.fitBounds(earthquakelayer.getBounds());
			}
			if (loadingBusstops === true){
				busstoplayer = L.geoJson(json).addTo(mymap);
				mymap.fitBounds(busstoplayer.getBounds());
			}

		// create a function to allow the last two buttons to remove the data from the map -->
		function removeEarthquakeData(){
			alert("Earthquake data will be removed");
			mymap.removeLayer(earthquakelayer);
		}		

		function removeBusstopData(){
			alert("Bus stop data will be removed");
			mymap.removeLayer(busstoplayer);
		}
	</script>
</head>
<body>
	<!-- the mapid div will hold the map -->
	<div id="mapid" style="width: 1200px; height: 500px;"></div>

	<!-- the following html will create a button to load the data -->
	<button id="loadEarthquakeData" name="loadEarthquakeData" onclick="loadEarthquakeData()">Click here to load the Earthquake data</button>

	<!-- the following will create a button to unload the data -->
	<button id="removeEarthquakeData" name="removeEarthquakeData" onclick="removeEarthquakeData()">Click here to remove the Earthquake data</button>

	<!-- the following will create a button to add the busstops layer to the map -->
	<button id="loadBusstopData" name="loadBusstopData" onclick="loadBusstopData()">Click here to load the Bus stop data</button>

	<!-- the following will create a button to remove the busstops layer to the map -->
	<button id="removeBusstopData" name="removeBusstopData" onclick="removeBusstopData()">Click here to remove the Bus stop data</button>

	<!-- the following script will load the map and set the default view and zoom, as well as loading the basemap tiles -->
	<script>
		// load the map (the last number refers to the scale - the larger the number, the more zoomed in the map is)
		var mymap = L.map('mapid').setView([51.505, -0.09], 13);

		// load the tiles
		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' + '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>,' + 'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(mymap);
	</script>
</body>
</html>